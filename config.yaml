# =============================================================================
# TRADING FRAMEWORK - BACKTEST CONFIGURATION
# =============================================================================

# === BACKTEST SETTINGS ===
backtest:
  # Test period (optional - uses all data if omitted)
  # period:
  #   start: "2025-12-01"
  #   end: "2026-01-22"
  
  # Initial capital
  capital:
    initial: 10000
  
  # Trading costs
  costs:
    commission: 0.001      # 0.1% per trade (simple: one value for now)
    # slippage: 0.0        # Future: add slippage
  
  # Execution settings
  execution:
    lookback_window: 100   # Bars to keep in memory for indicators


# === DATA SOURCE ===
data:
  symbols: ["XPLUSDT"]                           # Symbols to backtest
  timeframe: "1m"                                # Raw data timeframe (always 1m)
  source_dir: "data/raw"                         # Directory with parquet files
  source_file: "XPLUSDT-1m-2025-2026-01-22"     # Filename without .parquet extension

# === STRATEGY CONFIGURATION ===
strategy:
  timeframe: "5m"
  
  entry:
    name: "ema_cross_sma_cvd"
    params:
      ema_period: 59
      sma_period: 200
      cvd_window_minutes: 15      # Finestra rolling in minuti
      cvd_ratio_threshold: 20.0   # Entra long se ratio > +20%
      # CVD ratio range: -100 (tutto selling) a +100 (tutto buying)
      # +20% = 20% di volume netto Ã¨ buying
  
  exit:
    name: "atr_based_exit"
    params:
      atr_period: 14
      tp_multiplier: 9.0
      sl_multiplier: 5.5
  
  risk:
    name: "fixed_percent"
    params:
      risk_per_trade: 0.02
      max_drawdown: 0.15

# === INDICATORS ===
indicators:
  # Medie mobili
  - name: "ema"
    params: {period: 59}
    column: "ema_59"
  
  - name: "sma"
    params: {period: 200}
    column: "sma_200"
  
  # ATR per exit
  - name: "atr"
    params: {period: 14}
    column: "atr_14"
  
  # CVD RATIO - Nuovo indicatore semplice
  - name: "cvdratio"
    params:
      window_minutes: 15
      use_quote: false
    column: "cvd_ratio_15m"

# === PLOTTING ===
plotting:
  # Indicators to plot (overlaid on price chart)
  indicators_to_plot:
    - column: "ema_59"
      label: "EMA 59 (5m)"
      color: "#0052CC"
      linewidth: 2
      alpha: 0.8
    
    - column: "sma_200"
      label: "SMA 200 (5m)"
      color: "#FF6B00"
      linewidth: 2
      alpha: 0.8
  
  # SEPARATE PANELS (oscillators, volume, etc.)
  separate_panels:
    - column: "cvd_ratio_15m"
      label: "CVD Ratio 15m"
      color: "#8E44AD"
      linewidth: 1.5
      alpha: 0.7
      type: "oscillator"
      ylim: [-100, 100]            # Fixed range for CVD ratio
      zero_line: true              # Show zero line
  
  # Layout configuration
  layout:
    price_height_ratio: 3
    panel_height_ratio: 1
    position_height_ratio: 1
  
  # Style settings
  style:
    background_color: "#f5f5f5"
    grid_alpha: 0.2