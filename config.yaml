# =============================================================================
# TRADING FRAMEWORK - BACKTEST CONFIGURATION
# =============================================================================

# === BACKTEST SETTINGS ===
backtest:
  # Test period (optional - uses all data if omitted)
  # Start will be automatically normalized to midnight (00:00)
  period:
    start: "2026-01-16"
    end: "2026-01-22"
  
  # Initial capital
  capital:
    initial: 10000
  
  # Trading costs
  costs:
    commission: 0.001      # 0.1% per trade (entry + exit)
    # Note: Commission is applied twice (entry + exit)
    # Total cost per round-trip: ~0.2%
  
  # Execution settings
  execution:
    lookback_window: 100   # Bars to keep in memory for indicators


# === DATA SOURCE ===
data:
  symbols: ["XPLUSDT"]
  timeframe: "1m"  # Raw data is always 1m
  source_dir: "data/raw"
  source_file: "XPLUSDT-1m-2025-2026-01-22"

# === STRATEGY CONFIGURATION ===
# This is the heartbeat of the framework -> It's like Chart TF  in TradingView
# Strategies run on this timeframe
strategy:
  timeframe: "5m"
  
  # ========================================
  # NEW: Trading direction configuration
  # ========================================
  trading:
    allow_long: true   # Enable LONG positions
    allow_short: true  # Enable SHORT positions
    # Set both to true to test market-neutral strategy
    
    # Position Reversal Settings
    allow_reversal: true  # Enable position reversal
    # If false, wait for SL/TP before allowing opposite direction
  
  entry:
    name: "ema_cross_sma_cvd"
    params:
      ema_period: 54
      sma_period: 200

      #cvd_window_minutes: 15      
      # Separate thresholds for LONG/SHORT
      long_threshold: 50.0   # LONG if CVD > threshold
      short_threshold: 50.0  # SHORT if CVS < threshold
      # CVD Ratio Range: 0 (all selling) to +100 (all buying)
            
  
  exit:
    name: "atr_based_exit"
    params:
      atr_period: 21
      tp_multiplier: 9.5
      sl_multiplier: 5
  
  risk:
    name: "fixed_percent"
    params:
      risk_per_trade: 0.03    # 2% risk per trade
      max_drawdown: 0.15      # Stop trading if 15% drawdown

# === INDICATORS ===
indicators:
  # Moving Averages
  - name: "ema"
    params: {period: 54}
    column: "ema_54"
  
  - name: "sma"
    params: {period: 200}
    column: "sma_200"
  
  # ATR for exit strategy
  - name: "atr"
    params: 
      period: 21
      method: "wilder"  # Metodo originale (piÃ¹ accurato)
    column: "atr_21"
  
  # CVD Ratio - Volume Delta Indicator
  - name: "cvdratio"
    params:
      cumulative_period_minutes: 1   # Rolling window for CVD accumulation -> 1m Minumum
      signal_period_minutes: 15        # Rolling window for min/max (same as cumulative)
      use_quote: false                   # Use base volume (not quote volume)
    column: "cvd_ratio"

# === PLOTTING ===
plotting:
  # Indicators to plot (overlaid on price chart)
  indicators_to_plot:
    - column: "ema_54"
      label: "EMA"
      color: "#0052CC"
      linewidth: 2
      alpha: 0.8
    
    - column: "sma_200"
      label: "SMA 200"
      color: "#FF6B00"
      linewidth: 2
      alpha: 0.8


  sl_tp:
    enabled: true
    dynamic: true  # Enable dynamic trailing SL/TP
    style:
      tp_color: "#27AE60"      # Green
      sl_color: "#E74C3C"      # Red
      zone_color: "#F1C40F"    # Yellow for fill
      zone_alpha: 0.1
      line_width: 1.5
      line_style: "--"
    
    annotations:
      show_entry_exit: true
      show_pnl: true
      font_size: 8
      box_style: "round,pad=0.3"
  
  # SEPARATE PANELS (oscillators, volume, etc.)
  separate_panels:  # RIMUOVI il doppio "separate_panels:"!
    - column: "cvd_ratio"
      label: "CVD Signal %"
      color: "#8E44AD"
      linewidth: 1.5
      alpha: 0.7
      type: "oscillator"
      ylim: [0, 100]
      zero_line: false
      # Threshold lines
      hlines:
        # - value: 70
        #   color: "#2ECC71"
        #   linestyle: "--"
        #   alpha: 0.5
        #   label: "Bullish"
        - value: 50
          color: "#7F8C8D"
          linestyle: "-"
          alpha: 0.3
          label: "Neutral"
        # - value: 30
        #   color: "#E74C3C"
        #   linestyle: "--"
        #   alpha: 0.5
        #   label: "Bearish"
  
  # Layout configuration
  layout:
    price_height_ratio: 3
    panel_height_ratio: 1
    position_height_ratio: 1
  
  # Style settings
  style:
    background_color: "#f5f5f5"
    grid_alpha: 0.2

# === OUTPUT SETTINGS ===
output:
  journal:
    save_dir: "data/journals/"
  
  plots:
    enabled: true  # Set to false to disable plotting