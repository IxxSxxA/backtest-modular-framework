# =============================================================================
# TRADING FRAMEWORK - BACKTEST CONFIGURATION
# =============================================================================

# === DATA SOURCE ===
data:
  symbols: ["XPLUSDT"]
  timeframe: "1m"  # Raw data is always 1m
  source_dir: "data/raw"
  source_file: "XPLUSDT-1m-2025-2026-01-22" # File must be parquet format 1m TF 
# === DATA SOURCE END ===

# =============================================================================
# =============================================================================

# === BACKTEST SETTINGS ===
backtest:
  # Test period (optional - uses all data if omitted)
  # Start will be automatically normalized to midnight (00:00)
  period:
    start: "2026-01-16"
    end: "2026-01-22"
  
  # Initial capital
  capital:
    initial: 10000
  
  # Trading costs
  costs:
    commission: 0.001      # 0.1% per trade (entry + exit)
    # Note: Commission is applied twice (entry + exit)
    # Total cost per round-trip: ~0.2%
  
  # Execution settings
  execution:
    lookback_window: 100   # Bars to keep in memory for indicators


# === STRATEGY CONFIGURATION ===
# This is the heartbeat of the framework - like Chart TF in TradingView
# Strategies run on this timeframe
strategy:
  timeframe: "5m"
  
  # ========================================
  # Trading LONG/SHORT configuration
  # ========================================
  trading:
    allow_long: true   # Enable LONG positions
    allow_short: true  # Enable SHORT positions
    # Set both to true to test market-neutral strategy
    
    # Position Reversal Settings
    allow_reversal: true  # Enable position reversal
    # If false, wait for SL/TP before allowing opposite direction
  
  # ========================================
  # ENTRY STRATEGY
  # ========================================
  entry:
    name: "ema_cross_sma_cvd"
    
    # Strategy-specific parameters
    params:
      long_threshold: 50.0   # LONG if CVD > threshold
      short_threshold: 50.0  # SHORT if CVD < threshold
    
    # Indicators needed by this strategy
    # Framework auto-generates column names: ema_54, sma_200, cvd_ratio_1_15
    indicators:
      - name: "ema"
        period: 54
      
      - name: "sma"
        period: 200
      
      - name: "cvdratio"
        cumulative_period_minutes: 1   # Rolling window for CVD accumulation (1m minimum)
        signal_period_minutes: 15       # Rolling window for min/max
        use_quote: false                # Use base volume (not quote volume)
  
  # ========================================
  # EXIT STRATEGY
  # ========================================
  exit:
    name: "atr_based_exit"
    
    # Strategy-specific parameters
    params:
      tp_multiplier: 9.5
      sl_multiplier: 5
    
    # Indicators needed by this strategy
    indicators:
      - name: "atr"
        period: 21
        method: "wilder"  # Original Wilder's method (more accurate)
  
  # ========================================
  # RISK MANAGEMENT
  # ========================================
  risk:
    name: "fixed_percent"
    
    params:
      risk_per_trade: 0.03    # 3% risk per trade
      max_drawdown: 0.15      # Stop trading if 15% drawdown
    
    # No indicators needed for this risk manager


# === PLOTTING CONFIGURATION ===
plotting:
  # ========================================
  # INDICATORS ON PRICE CHART
  # ========================================
  indicators_to_plot:
    - column: "ema_54"      # Auto-generated column name
      label: "EMA 54"
      color: "#0052CC"
      linewidth: 2
      alpha: 0.8
    
    - column: "sma_200"
      label: "SMA 200"
      color: "#FF6B00"
      linewidth: 2
      alpha: 0.8
    
    # EXAMPLE: Plot an indicator NOT used by strategy (for visual analysis only)
    # Uncomment to add Supertrend to the chart:
    # - column: "supertrend_10_3"  # Will be auto-generated if you add to extra_indicators
    #   label: "Supertrend"
    #   color: "#9B59B6"
    #   linewidth: 1.5
    #   alpha: 0.7

  # ========================================
  # STOP LOSS / TAKE PROFIT VISUALIZATION
  # ========================================
  sl_tp:
    enabled: true
    dynamic: true  # Enable dynamic trailing SL/TP
    style:
      tp_color: "#27AE60"      # Green
      sl_color: "#E74C3C"      # Red
      zone_color: "#F1C40F"    # Yellow for fill
      zone_alpha: 0.1
      line_width: 1.5
      line_style: "--"
    
    annotations:
      show_entry_exit: true
      show_pnl: true
      font_size: 8
      box_style: "round,pad=0.3"
  
  # ========================================
  # SEPARATE PANELS (oscillators, volume, etc.)
  # ========================================
  separate_panels:
    - column: "cvd_ratio_1_15"  # Auto-generated: cvdratio with params 1, 15
      label: "CVD Signal %"
      color: "#8E44AD"
      linewidth: 1.5
      alpha: 0.7
      type: "oscillator"
      ylim: [0, 100]
      zero_line: false
      # Threshold lines
      hlines:
        - value: 50
          color: "#7F8C8D"
          linestyle: "-"
          alpha: 0.3
          label: "Neutral"
  
  # Layout configuration
  layout:
    price_height_ratio: 3
    panel_height_ratio: 1
    position_height_ratio: 1
  
  # Style settings
  style:
    background_color: "#f5f5f5"
    grid_alpha: 0.2


# === EXTRA INDICATORS (Optional) ===
# Indicators calculated for analysis/plotting but NOT used by the strategy
# Uncomment to enable:
# 
# extra_indicators:
#   - name: "supertrend"
#     period: 10
#     multiplier: 3
#     # Auto-generates column: supertrend_10_3
#   
#   - name: "rsi"
#     period: 14
#     # Auto-generates column: rsi_14


# === OUTPUT SETTINGS ===
output:
  journal:
    save_dir: "data/journals/"
  
  plots:
    enabled: true  # Set to false to disable plotting