# =============================================================================
# TRADING FRAMEWORK - BACKTEST CONFIGURATION
# =============================================================================

# === BACKTEST SETTINGS ===
backtest:
  # Test period (optional - uses all data if omitted)
  # Start will be automatically normalized to midnight (00:00)
  period:
    start: "2026-01-16"
    end: "2026-01-22"
  
  # Initial capital
  capital:
    initial: 10000
  
  # Trading costs
  costs:
    commission: 0.001      # 0.1% per trade (entry + exit)
    # Note: Commission is applied twice (entry + exit)
    # Total cost per round-trip: ~0.2%
  
  # Execution settings
  execution:
    lookback_window: 100   # Bars to keep in memory for indicators


# === DATA SOURCE ===
data:
  symbols: ["XPLUSDT"]
  timeframe: "1m"  # Raw data is always 1m
  source_dir: "data/raw"
  source_file: "XPLUSDT-1m-2025-2026-01-22"

# === STRATEGY CONFIGURATION ===
strategy:
  timeframe: "5m"
  
  # ========================================
  # NEW: Trading direction configuration
  # ========================================
  trading:
    allow_long: true   # Enable LONG positions
    allow_short: true  # Enable SHORT positions
    # Set both to true to test market-neutral strategy
  
  entry:
    name: "ema_cross_sma_cvd"
    params:
      ema_period: 59
      sma_period: 200
      cvd_window_minutes: 5
      
      # Separate thresholds for LONG/SHORT
      long_threshold: 3.0   # Enter LONG when CVD > +20%
      short_threshold: -3.0 # Enter SHORT when CVD < -20%
      
      # CVD Ratio Range: -100 (all selling) to +100 (all buying)
      # +20% = 20% net buying pressure
      # -20% = 20% net selling pressure
  
  exit:
    name: "atr_based_exit"
    params:
      atr_period: 14
      tp_multiplier: 9.0
      sl_multiplier: 5.5
  
  risk:
    name: "fixed_percent"
    params:
      risk_per_trade: 0.02    # 2% risk per trade
      max_drawdown: 0.15      # Stop trading if 15% drawdown

# === INDICATORS ===
indicators:
  # Moving Averages
  - name: "ema"
    params: {period: 59}
    column: "ema_59"
  
  - name: "sma"
    params: {period: 200}
    column: "sma_200"
  
  # ATR for exit strategy
  - name: "atr"
    params: {period: 14}
    column: "atr_14"
  
  # CVD Ratio - Volume Delta Indicator
  - name: "cvdratio"
    params:
      window_minutes: 15
      use_quote: false  # Use base volume (not quote volume)
    column: "cvd_ratio_15m"

# === PLOTTING ===
plotting:
  # Indicators to plot (overlaid on price chart)
  indicators_to_plot:
    - column: "ema_59"
      label: "EMA 59 (5m)"
      color: "#0052CC"
      linewidth: 2
      alpha: 0.8
    
    - column: "sma_200"
      label: "SMA 200 (5m)"
      color: "#FF6B00"
      linewidth: 2
      alpha: 0.8
  
  # SEPARATE PANELS (oscillators, volume, etc.)
  separate_panels:
    - column: "cvd_ratio_15m"
      label: "CVD Ratio 15m"
      color: "#8E44AD"
      linewidth: 1.5
      alpha: 0.7
      type: "oscillator"
      ylim: [-100, 100]
      zero_line: true
      # Add threshold lines
      hlines:
        - value: 20
          color: "#2ECC71"
          linestyle: "--"
          alpha: 0.5
          label: "LONG threshold"
        - value: -20
          color: "#E74C3C"
          linestyle: "--"
          alpha: 0.5
          label: "SHORT threshold"
  
  # Layout configuration
  layout:
    price_height_ratio: 3
    panel_height_ratio: 1
    position_height_ratio: 1
  
  # Style settings
  style:
    background_color: "#f5f5f5"
    grid_alpha: 0.2

# === OUTPUT SETTINGS ===
output:
  journal:
    save_dir: "data/journals/"
  
  plots:
    enabled: true  # Set to false to disable plotting